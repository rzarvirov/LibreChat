{"code":"import { __assign, __awaiter, __generator } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport axios from 'axios';\nimport * as endpoints from './api-endpoints';\nimport { setTokenHeader } from './headers-helpers';\nfunction _get(url, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.get(url, __assign({}, options))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _getResponse(url, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.get(url, __assign({}, options))];\n                case 1: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nfunction _post(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.post(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _postMultiPart(url, formData, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.post(url, formData, __assign(__assign({}, options), { headers: { 'Content-Type': 'multipart/form-data' } }))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _postTTS(url, formData, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.post(url, formData, __assign(__assign({}, options), { headers: { 'Content-Type': 'multipart/form-data' }, responseType: 'arraybuffer' }))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _put(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.put(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _delete(url) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.delete(url)];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _deleteWithOptions(url, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.delete(url, __assign({}, options))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _patch(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.patch(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nvar isRefreshing = false;\nvar failedQueue = [];\nvar refreshToken = function (retry) {\n    return _post(endpoints.refreshToken(retry));\n};\nvar dispatchTokenUpdatedEvent = function (token) {\n    setTokenHeader(token);\n    window.dispatchEvent(new CustomEvent('tokenUpdated', { detail: token }));\n};\nvar processQueue = function (error, token) {\n    if (token === void 0) { token = null; }\n    failedQueue.forEach(function (prom) {\n        if (error) {\n            prom.reject(error);\n        }\n        else {\n            prom.resolve(token);\n        }\n    });\n    failedQueue = [];\n};\naxios.interceptors.response.use(function (response) { return response; }, function (error) { return __awaiter(void 0, void 0, void 0, function () {\n    var originalRequest, token, err_1, response, token, err_2;\n    var _a, _b, _c;\n    return __generator(this, function (_d) {\n        switch (_d.label) {\n            case 0:\n                originalRequest = error.config;\n                if (!error.response) {\n                    return [2 /*return*/, Promise.reject(error)];\n                }\n                if (((_a = originalRequest.url) === null || _a === void 0 ? void 0 : _a.includes('/api/auth/logout')) === true) {\n                    return [2 /*return*/, Promise.reject(error)];\n                }\n                if (!(error.response.status === 401 && !originalRequest._retry)) return [3 /*break*/, 13];\n                console.warn('401 error, refreshing token');\n                originalRequest._retry = true;\n                if (!isRefreshing) return [3 /*break*/, 5];\n                _d.label = 1;\n            case 1:\n                _d.trys.push([1, 4, , 5]);\n                return [4 /*yield*/, new Promise(function (resolve, reject) {\n                        failedQueue.push({ resolve: resolve, reject: reject });\n                    })];\n            case 2:\n                token = _d.sent();\n                originalRequest.headers['Authorization'] = 'Bearer ' + token;\n                return [4 /*yield*/, axios(originalRequest)];\n            case 3: return [2 /*return*/, _d.sent()];\n            case 4:\n                err_1 = _d.sent();\n                return [2 /*return*/, Promise.reject(err_1)];\n            case 5:\n                isRefreshing = true;\n                _d.label = 6;\n            case 6:\n                _d.trys.push([6, 11, 12, 13]);\n                return [4 /*yield*/, refreshToken(\n                    // Handle edge case where we get a blank screen if the initial 401 error is from a refresh token request\n                    ((_b = originalRequest.url) === null || _b === void 0 ? void 0 : _b.includes('api/auth/refresh')) === true ? true : false)];\n            case 7:\n                response = _d.sent();\n                token = (_c = response === null || response === void 0 ? void 0 : response.token) !== null && _c !== void 0 ? _c : '';\n                if (!token) return [3 /*break*/, 9];\n                originalRequest.headers['Authorization'] = 'Bearer ' + token;\n                dispatchTokenUpdatedEvent(token);\n                processQueue(null, token);\n                return [4 /*yield*/, axios(originalRequest)];\n            case 8: return [2 /*return*/, _d.sent()];\n            case 9:\n                if (window.location.href.includes('share/')) {\n                    console.log(\"Refresh token failed from shared link, attempting request to \".concat(originalRequest.url));\n                }\n                else {\n                    window.location.href = '/login';\n                }\n                _d.label = 10;\n            case 10: return [3 /*break*/, 13];\n            case 11:\n                err_2 = _d.sent();\n                processQueue(err_2, null);\n                return [2 /*return*/, Promise.reject(err_2)];\n            case 12:\n                isRefreshing = false;\n                return [7 /*endfinally*/];\n            case 13: return [2 /*return*/, Promise.reject(error)];\n        }\n    });\n}); });\nexport default {\n    get: _get,\n    getResponse: _getResponse,\n    post: _post,\n    postMultiPart: _postMultiPart,\n    postTTS: _postTTS,\n    put: _put,\n    delete: _delete,\n    deleteWithOptions: _deleteWithOptions,\n    patch: _patch,\n    refreshToken: refreshToken,\n    dispatchTokenUpdatedEvent: dispatchTokenUpdatedEvent,\n};\n//# sourceMappingURL=request.js.map","references":["/Users/romanzarvirov/aibuddy/LibreChat/node_modules/axios/index.d.ts","/Users/romanzarvirov/aibuddy/LibreChat/packages/data-provider/src/api-endpoints.ts","/Users/romanzarvirov/aibuddy/LibreChat/packages/data-provider/src/headers-helpers.ts","/Users/romanzarvirov/aibuddy/LibreChat/packages/data-provider/src/types.ts"],"map":"{\"version\":3,\"file\":\"request.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/request.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/romanzarvirov/aibuddy/LibreChat/packages/data-provider/dist/types/request.d.ts","writeByteOrderMark":false,"text":"import { AxiosRequestConfig } from 'axios';\nimport type * as t from './types';\ndeclare function _get<T>(url: string, options?: AxiosRequestConfig): Promise<T>;\ndeclare function _getResponse<T>(url: string, options?: AxiosRequestConfig): Promise<T>;\ndeclare function _post(url: string, data?: any): Promise<any>;\ndeclare function _postMultiPart(url: string, formData: FormData, options?: AxiosRequestConfig): Promise<any>;\ndeclare function _postTTS(url: string, formData: FormData, options?: AxiosRequestConfig): Promise<any>;\ndeclare function _put(url: string, data?: any): Promise<any>;\ndeclare function _delete<T>(url: string): Promise<T>;\ndeclare function _deleteWithOptions<T>(url: string, options?: AxiosRequestConfig): Promise<T>;\ndeclare function _patch(url: string, data?: any): Promise<any>;\ndeclare const _default: {\n    get: typeof _get;\n    getResponse: typeof _getResponse;\n    post: typeof _post;\n    postMultiPart: typeof _postMultiPart;\n    postTTS: typeof _postTTS;\n    put: typeof _put;\n    delete: typeof _delete;\n    deleteWithOptions: typeof _deleteWithOptions;\n    patch: typeof _patch;\n    refreshToken: (retry?: boolean | undefined) => Promise<t.TRefreshTokenResponse | undefined>;\n    dispatchTokenUpdatedEvent: (token: string) => void;\n};\nexport default _default;\n"}}
